---
title: "Turbo Kodierer"
author: "Witsch Daniel"
date: "18 April 2016"
output: 
  beamer_presentation:
    keep_tex: true
params:
  orig: !r c(1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1)
  interl: !r c(2,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1)
  parity1: !r c(3,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1)
  parity2: !r c(4,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1)
  result: !r c(5,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1)
  encoder: !r list(N=2, M=2, generators=c(5,7), rsc=TRUE, termination=c(0,1,1,0), next.state=matrix(c(0,2,3,1,2,0,1,3), ncol =2), prev.state=matrix(c(0,3,1,2,1,2,0,3,-1,-1,-1,-1), ncol =3), output=matrix(c(0,0,1,1,3,3,2,2), ncol =2))
header-includes:
- \usepackage{tikz}
- \usepackage{pgfplots}
- \usetikzlibrary{arrows,decorations.pathmorphing,backgrounds,positioning,fit,petri,calc}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
decToBin <- function(x) { if (all(x<2)) x else paste(decToBin(x%/%2), x%%2, sep="") }
```


```{r, echo=FALSE}
node.short <- 20
node.long <- 45
dots <- function (v, node) if(length(v) > node) ", ..." else ""

if (params$encoder$rsc == TRUE) {
  art.coder <- "Rekursiver"
} else {
  art.coder <- "Nicht-Rekursiver"
}
```

## Kodierer Information

- `r art.coder` Kodierer
- Anzahl von Ausgängen : `r params$encoder$N`
- Anzahl von Registern : `r params$encoder$M`
- Generatoren : `r params$encoder$generators`

## Kodierer Matrix : Nächster Zustand
```{r, results='asis'}
next.table <- params$encoder$next.state
colnames(next.table) <- c("Bit 0", "Bit 1")
row.counter <- rep(1:dim(next.table)[1])
rownames(next.table) <- paste("Zustand ", row.counter)
knitr::kable(next.table, align="c")
```

## Kodierer Matrix : Voriger Zustand
```{r, results='asis'}
prev.table <- params$encoder$prev.state
colnames(prev.table) <- c("Bit 0", "Bit 1", "2.Möglichkeit")
row.counter <- rep(1:dim(prev.table)[1])
rownames(prev.table) <- paste("Zustand ", row.counter)
knitr::kable(prev.table, align="c")
```

## Kodierer Matrix : Ausgangsbits
```{r, results='asis'}
output.table <- params$encoder$output
output.table <- matrix(decToBin(as.vector(output.table)),ncol=dim(output.table)[2])
colnames(output.table) <- c("Bit 0", "Bit 1")
row.counter <- rep(1:dim(output.table)[1])
rownames(output.table) <- paste("Zustand ", row.counter)
knitr::kable(output.table, align="c")
```

## Turbo-Kodierer

- Input : `r head(params$orig, node.short)``r dots(params$orig, node.short)`

\begin{center}
\begin{tikzpicture}[node distance=8mm, inner sep=2mm, outer sep=0, >=stealth, font=\tiny]

\tikzstyle{encoderStyle} = [rectangle, draw, minimum height=height("Inp")+4mm]
\tikzstyle{interleaverStyle} = [encoderStyle]
\tikzstyle{startEndStyle} = [encoderStyle]
\tikzstyle{multiplexerStyle} = [encoderStyle]
\tikzstyle{showStyle} = [rectangle, draw, thick, draw=red, text=red, inner sep=1.5mm]
\tikzstyle{arrowStyle} = [->]
\tikzstyle{showDrawStyle} = [->, red, thick]

\node [interleaverStyle] (interleaver) {Interleaver};
\node [encoderStyle] (encoder1) [above right=of interleaver] {Kodierer 1};
\node [encoderStyle] (encoder2) [below right=of interleaver] {Kodierer 2};
\node [] (multiplexerTemp) [right=of encoder1] {};
\node [multiplexerStyle, rotate=90] (multiplexer) at (multiplexerTemp.east) {Multiplexer};
\node [startEndStyle] (start) [above left=of interleaver] {Input};
\node [startEndStyle] (end) [right=of multiplexerTemp] {Output};

\draw [arrowStyle] (interleaver.south) |- node (afterInterleaver) {}(encoder2.west);
\draw [arrowStyle] (encoder1.east) -- node (afterParity1) {} (multiplexer.north);
\draw [arrowStyle] (start.east)  -| node[midway] (afterInput) {} (interleaver.north);
\draw [arrowStyle] (afterInput.center) |- (encoder1.west);
\draw [arrowStyle] (encoder2.east) -| ++(0.2,0.7) node (afterParity2) {} |- ($(multiplexer.north)+(0,-.5)$);
\draw [arrowStyle] (afterInput.center) |- ($(multiplexer.north)+(0,.5)$);
\draw [arrowStyle] (multiplexer.south) -- node (afterMultiplexer) {} (end.west);

\begin{scope}[on background layer]
\node [draw, fit=(encoder1) (interleaver) (encoder2) (multiplexer)] (background) {};
\end{scope}

\visible<2>{
  \node [showStyle] (showAbove) [above=4mm of background] {\textbf{`r head(params$orig, node.short)``r dots(params$orig, node.short)`}};
  \draw [showDrawStyle] (showAbove) -- (afterInput.center);
  \node [showStyle] (showBelow) [below=4mm of background] {\textbf{`r head(params$parity1, node.short)``r dots(params$parity1, node.short)`}};
  \draw [showDrawStyle] (showBelow) -- (afterParity1.center);
  }
\visible<3>{
  \node [showStyle] (showAbove) [above=4mm of background] {\textbf{`r head(params$orig, node.short)``r dots(params$orig, node.short)`}};
  \draw [showDrawStyle] (showAbove) -- (afterInput.center);
  \node [showStyle] (showBelow) [below=4mm of background] {\textbf{`r head(params$interl, node.short)``r dots(params$interl, node.short)`}};
  \draw [showDrawStyle] (showBelow) -- (afterInterleaver.center);
  }
\visible<4>{
  \node [showStyle] (showAbove) [above=4mm of background] {\textbf{`r head(params$interl, node.short)``r dots(params$interl, node.short)`}};
  \draw [showDrawStyle] (showAbove) -- (afterInterleaver);
  \node [showStyle] (showBelow) [below=4mm of background] {\textbf{`r head(params$parity2, node.short)``r dots(params$parity2, node.short)`}};
  \draw [showDrawStyle] (showBelow) -- (afterParity2.center);
  }

\end{tikzpicture}
\end{center}

- Output : `r head(params$result, node.long)``r dots(params$result, node.long)`
